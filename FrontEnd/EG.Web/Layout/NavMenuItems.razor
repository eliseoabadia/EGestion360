@using EG.Web.Models.Configuration
@using MudBlazor

@if (Items != null && Items.Any())
{
    @foreach (var item in Items.OrderBy(m => m.Orden))
    {
        @if (item.Children?.Any() == true)
        {
            <MudNavGroup Title="@item.Nombre"
                         Icon="@GetIcon(item.ImageUrl)"
                         Expanded="@GetExpandedState(item.PkidMenu)"
                         ExpandedChanged="@(EventCallback.Factory.Create<bool>(this, (v) => OnExpandedChanged.InvokeAsync((item.PkidMenu, v))))">
                <NavMenuItems Items="@item.Children"
                              GetIcon="GetIcon"
                              ExpandedStates="ExpandedStates"
                              OnExpandedChanged="OnExpandedChanged" />
            </MudNavGroup>
        }
        else
        {
            <MudNavLink Href="@item.Ruta"
                        Match="@(item.Ruta == "/" ? NavLinkMatch.All : NavLinkMatch.Prefix)"
                        Icon="@GetIcon(item.ImageUrl)">
                @item.Nombre
            </MudNavLink>
        }
    }
}

@code {
    [Parameter]
    public List<MenuItem> Items { get; set; } = new();

    [Parameter]
    public Func<string, string> GetIcon { get; set; } = _ => Icons.Material.Filled.Info;

    [Parameter]
    public Dictionary<long, bool> ExpandedStates { get; set; } = new();

    [Parameter]
    public EventCallback<(long?, bool)> OnExpandedChanged { get; set; }

    private bool GetExpandedState(long? pkId)
    {
        return pkId.HasValue && ExpandedStates.TryGetValue(pkId.Value, out var state) ? state : false;
    }
}